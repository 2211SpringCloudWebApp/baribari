<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<title>게시글 등록</title>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
		<link href="../../../css/community/board/register.css" rel="stylesheet">
		<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
		
		<!-- Favicons -->
		<link href="assets/img/favicon.png" rel="icon">
		<link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
		
		  <!-- Google Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@200&display=swap" rel="stylesheet">
		
		<!-- Vendor CSS Files -->
		<link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet">
		<link href="assets/vendor/aos/aos.css" rel="stylesheet">
		<link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
		<link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
		<link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
		<link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
		
		<!-- Template Main CSS File -->
		<link href="assets/css/style.css" rel="stylesheet">
	</head>
	<body>
        <header>
        	<div th:replace="header.html :: header"></div>
        </header>
        <div id="container">
            <main>
                <table id="fregister-header">
                    <tr>
                        <td colspan="2">
                            글쓰기
                        </td>
                    </tr>
                </table>
                
                <table id="fregister-main">
                    <tr>
                        <td>
                            <select>
                                <option value="">[말머리]</option>
                                <option value="잡담">[잡담]</option>
                                <option value="캠핑지">[캠핑지]</option>
                            </select>
                        </td>
                        <td>
                            <input type="text" required placeholder="제목을 입력하세요.">
                        </td>
                    </tr>

                    <tr>
                        <td colspan="2">
                            <textarea rows="" cols="" placeholder="내용을 입력하세요"></textarea>
                        </td>
                    </tr>
					<tr>
						<td>
							<input id="showTage" type="text" readonly="readonly" >
						</td>
					</tr>
                    <tr>
                        <td colspan="2">
                            <input id="inputTage" type="text" placeholder="#해시태그 입력 ,로 구분" onmousedown="onmouseEvent()" >
                        </td>
                    </tr>
                </table>
                <table id="fregister-option">
                    <tr>
                        <td>
                            지도첨부 <input type="button" value="장소선택">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            사진첨부 <input type="file">
                        </td>
                    </tr>
                </table>
                <table id="fregister-photo">
                    <tr>
                        <td>1</td>
                        <td>2</td>
                        <td>3</td>
                        <td>4</td>
                        <td>5</td>
                        <td>6</td>
                        <td>7</td>
                        <td>8</td>
                        <td>9</td>
                        <td>10</td>
                    </tr>
                </table>
                <table id="fregister-footer">
                    <tr>
                        <td>
                            <input type="submit" value="등록">
                        </td>
                        <td>
                            <input type="reset" value="취소">
                        </td>
                    </tr>
                </table>
            </main>
        </div>
        <script>
	        function onmouseEvent(){
	            document.addEventListener('keydown', handleKeyDown);
	        }
			//해시태그 동작 부분
	        function handleKeyDown(event) {
	            if (event.key === ',') {
	                // ',' 키가 눌렸을 때 해시태그 유효성 검사
	                var inputTage = document.getElementById('inputTage');
	                var tags = inputTage.value; // 입력된 태그들 가져오기
	                var tagArr = tags.split(','); // 태그들을 ','로 구분하여 배열로 변환
	
	                for (var i = 0; i < tagArr.length; i++) {
	                    var tag = tagArr[i].trim(); // 각 태그의 양 끝 공백 제거
	
	                    // 태그 유효성 검사 (예시: '#'으로 시작하고, 2자 이상)
	                    if (tag.charAt(0) !== '#') {
	                        alert('태그 앞에는 #을 붙여주세요.');
	                        inputTage.value = "";
	                        event.preventDefault(); // ,가 남아있지 않도록 기본 이벤트를 막음
	                        return; // 유효하지 않은 태그일 경우 함수 종료
	                    }
	                    if (tag.length < 3) {
	                        alert('태그는 두글자 이상이어야 합니다.');
	                        inputTage.value = "";
	                        event.preventDefault(); // ,가 남아있지 않도록 기본 이벤트를 막음
	                        return; // 유효하지 않은 태그일 경우 함수 종료
	                    }
	                }
	                registerHashTag(tags);
	                getHashTag();
	                alert('유효한 해시태그 등록');
	                inputTage.value = "";
	                event.preventDefault(); // ,가 남아있지 않도록 기본 이벤트를 막음
	            }
	        }
	        // 헤시태그 출력 함수
	        getHashTag();
	        function getHashTag(){
	        	const communityNo = 60;
	        	var showTage = $("#showTage");
	        	$.ajax({
	        		url : "getHashTag",
	        		data : {
	        			"communityNo": communityNo
	        			},
	        		type : "GET",
	        		success : function(data){
	        			//showTage.empty();
	        			showTage.val(data);
	        		},
	        		error : function(){
	        			showTage.val("");
	        		}
	        	});
	        }
	        // 해시태그 등록 함수
	        function registerHashTag(tags){
	        	const hasgTag = tags;
	        	const communityNo = 60;
	        	console.log('접근성공');
	        	$.ajax({
	        		url:"registerHashTag",
	        		data:{
	        			"communityNo" : communityNo,
	        			"hasgTag" : hasgTag
	        		},
	        		type:"GET",
	        		success : function(){
	        			alert("태그등록 성공");
	        		},
	        		error : function(){
	        			alert("태그등록 실패");
	        		}
	        	});
	        }
        </script>
        <footer>
            <div th:replace="footer.html :: footer"></div>
        </footer>
    </body>
</html>