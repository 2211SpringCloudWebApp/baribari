<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <title>회원가입-유저</title>
    <link href="css/styles.css" rel="stylesheet"/>
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/registerUserCss.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="js/login.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

</head>
<body class="bg-primary">
<div class="materialContainer">

    <div class="box">
        <div class="container">
            <div class="input-form-backgroud row">
                <div class="input-form col-md-12 mx-auto">
                    <h4 class="">회원가입</h4>
                    <form class="validation-form" action="/registerUserProc" method="post" novalidate>
<!--                        <div class="row">-->
                            <div class="mb-3" id="id-container">
                                <label for="id">아이디</label>
                                <input type="text" class="form-control" id="id" name="id" placeholder="" value="" required maxlength="16">
                                <div class="invalid-feedback id-check-error">
                                    4~16자의 영어 소문자 또는 영어소문자와 숫자로 아이디를 입력해주세요.
                                </div>
                                <div class='invalid-feedback id-check-success' style='color: #0a53be'>
                                    사용가능한 아이디 입니다.
                                </div>
                                <div class='invalid-feedback id-check-same'>
                                    중복된 아이디 입니다.
                                </div>
                            </div>

<!--                        </div>-->
                        <div class=" mb-3">
                            <label for="password">비밀번호</label>
                            <input type="password" class="form-control" id="password" name="password" placeholder="" value="" required maxlength="16">
                            <div class="invalid-feedback pass-check-error">
                                6자 이상 16자 이하, 영어와 숫자의 조합으로 입력해주세요!
                            </div>
                            <div class="invalid-feedback pass-check-success" style="color: #0a53be">
                                사용가능합니다!
                            </div>
                        </div>
                        <div class=" mb-3">
                            <label for="re-password">비밀번호 확인</label>
                            <input type="password" class="form-control" id="re-password" name="password" placeholder="" value="" required maxlength="16">
                            <div class="invalid-feedback re-pass-check-success" style="color:#0a53be">
                                비밀번호가 일치합니다.
                            </div>
                            <div class="invalid-feedback re-pass-check-error">
                                비밀번호가 일치하지 않습니다.
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="name">이름</label>
                            <input type="text" class="form-control" id="name" placeholder="" name="name" required maxlength="16">
                            <div class="invalid-feedback">
                                이름을 입력해주세요.
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="nickname">닉네임</label>
                            <input type="text" class="form-control" id="nickname" placeholder="" name="nickname" required maxlength="16">
                            <div class="invalid-feedback nickName-check-error">
                                2자 이상 16자 이하, 영어 또는 숫자 또는 한글로 작성해주세요!
                            </div>
                            <div class="invalid-feedback nickName-check-success" style="color:#0a53be">
                                예쁜 닉네임이네요~!
                            </div>
                            <div class="invalid-feedback nickName-check-same">
                                중복된 닉네임 입니다.
                            </div>
                        </div>
                        <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="email-id">이메일</label>
                            <input type="email" class="form-control" id="email-id" placeholder="" required>
                            <div class="invalid-feedback">
                                이메일을 입력해주세요.
                            </div>
                        </div>
                            <div class="col-md-1 phoneHyphen">
                                @
                            </div>
                            <div class="col-md-4">
                                <label for="domain">&nbsp;</label>
                                <input type="email" class="form-control" id="domain" placeholder="" name="domain" required>
                            </div>
                            <div class="col-md-3">
                                <label for="email">&nbsp;</label>
                                <select class="custom-select d-block w-100 domain-selectBox">
                                    <option value="etc">직접입력</option>
                                    <option value="naver.com">naver.com</option>
                                    <option value="gmail.com">gmail.com</option>
                                    <option value="hanmail.net">hanmail.net</option>
                                    <option value="hotmail.com">hotmail.com</option>
                                </select>
                                <input type="hidden" name="email" id="email">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="phone1">전화번호</label>
                                <select class="custom-select d-block w-100" id="phone1" required>
                                    <option value="010">010</option>
                                    <option value="011">011</option>
                                    <option value="017">017</option>
                                    <option value="018">018</option>
                                </select>
                            </div>
                            <div class="col-md-1 mb-3 phoneHyphen">-</div>
                            <div class="col-md-3 mb-3">
                                <label for="phone2">&nbsp;</label>
                                <input type="text" class="form-control" id="phone2" placeholder="" required maxlength="4">
                            </div>
                            <div class="col-md-1 mb-3 phoneHyphen">-</div>
                            <div class="col-md-3 mb-3">
                                <label for="phone3">&nbsp;</label>
                                <input type="text" class="form-control" id="phone3" placeholder="" required maxlength="4">
                                <input type="hidden" id="phone0" name="phone">
                            </div>

                        </div>
                        <hr class="mb-4">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="aggrement" required>
                            <label class="custom-control-label" for="aggrement">개인정보 수집 및 이용에 동의합니다.</label>
                        </div>
                        <div class="mb-4"></div>
                        <button class="btn btn-primary btn-lg btn-block" type="submit" >가입 완료</button>
                    </form>
                </div>
            </div>
            <footer class="my-3 text-center text-small">
                <p class="mb-1">&copy; 2023 BARIBARI</p>
            </footer>
        </div>
        <script>
            function stringJoin(){
                var phone = $('#phone1').val() + '-' + $('#phone2').val() + '-' + $('#phone3').val();
                var email = $('#email-id').val() + '@' + $('#domain').val();
                $('#phone0').val(phone);
                $('#email').val(email);
            }
            window.addEventListener('load', () => {
                const forms = document.getElementsByClassName('validation-form');
                Array.prototype.filter.call(forms, (form) => {
                    form.addEventListener('submit',function (event) {
                        stringJoin();
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                        $('.id-check-success').css('display','none');
                        $('.id-check-same').css('display','none');
                        $('.nickName-check-success').css('display','none');
                        $('.nickName-check-same').css('display','none');
                        $('.pass-check-success').css('display','none');
                        $('.re-pass-check-success').css('display','none');
                        form.style.margin = '0px';
                    }, false);
                });
            }, false);

            // 아이디 중복 검증 및 정규표현식
            $('#id').focusout(function(){
                // 아이디 정규표현식
                const regex = /^[a-z0-9]{4,16}$/;
                if(regex.test($('#id').val())){
                    $.ajax({
                        url:"ajaxCheckId",
                        data:{
                            'id':$('#id').val()
                        },
                        type:'get',
                        dataType:'json',
                        success:function(data){
                            if(data === '사용가능'){
                                $('.id-check-error').css('display','none');
                                $('.id-check-success').css('display','block');
                                $('.id-check-same').css('display','none');
                            }else {
                                $('.id-check-error').css('display','none');
                                $('.id-check-success').css('display','none');
                                $('.id-check-same').css('display','block');
                            }
                        },
                        error:function(){
                            console.log("서버에러");
                        }
                    });
                }else {
                    $('.id-check-same').css('display','none');
                    $('.id-check-success').css('display','none');
                    $('.id-check-error').css('display','block');
                }
            });

            // 패스워드 정규표현식
            $('#password').focusout(function(){
                const regex = /^(?=.*[0-9])(?=.*[a-zA-Z])[a-zA-Z0-9!@#$%^&*()._-]{6,16}$/;
               if(regex.test($('#password').val())){
                   $('.pass-check-success').css('display','block');
                   $('.pass-check-error').css('display','none');
               }else {
                   $('.pass-check-error').css('display','block');
                   $('.pass-check-success').css('display','none');
               }
            });

            // 비밀번호 확인 검증
            $('#re-password').focusout(function(){
               const rePass = $('#re-password').val();
               const pass = $('#password').val();
               if(rePass === pass){
                   $('.re-pass-check-success').css('display','block');
                   $('.re-pass-check-error').css('display','none');
               }else {
                   $('.re-pass-check-success').css('display','none');
                   $('.re-pass-check-error').css('display','block');
               }
            });

            // 이메일 셀렉트 박스 도메인에 넣기
            $('.domain-selectBox').on("change",function(){
                const inputBox = $('#domain');
                const selectBox = $('.domain-selectBox').val();
                if(selectBox === 'etc'){
                    inputBox.val('');
                    inputBox.prop('readonly',false);
                }else {
                    inputBox.val(selectBox);
                    inputBox.prop('readonly',true);
                }
            });

            // 닉네임 정규표현식
            $('#nickname').focusout(function(){
                const regex = /^(?=.*[a-z0-9가-힣])[a-z0-9가-힣]{2,16}$/;
                if(regex.test($('#nickname').val())){
                    $.ajax({
                        url:'/ajaxNickNameCheck',
                        type:'get',
                        dataType: 'json',
                        data:{
                            'nickName' : $('#nickname').val()
                        },
                        succcess: function(data){
                            console.log(data);
                            if(data === '중복'){
                                $('.nickName-check-success').css('display','none');
                                $('.nickName-check-error').css('display','none');
                                $('.nickName-check-same').css('display','block');
                            }else  {
                                $('.nickName-check-success').css('display','block');
                                $('.nickName-check-error').css('display','none');
                                $('.nickName-check-same').css('display','none');
                            }
                        },
                        error:function(){
                            console.log('서버에러');
                        }
                    });
                }else {
                    $('.nickName-check-success').css('display','none');
                    $('.nickName-check-error').css('display','block');
                    $('.nickName-check-same').css('display','none');

                }
            });


        </script>
    </div>
</div>
</body>
</html>
